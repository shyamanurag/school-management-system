{% extends 'base.html' %}
{% block content %}
{% block breadcrumbs %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-light px-3 py-2 mb-3">
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Students</li>
  </ol>
</nav>
{% endblock %}

<div class="container mt-4">
    <h2 class="mb-3">Student List</h2>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <input type="text" id="studentSearch" class="form-control" placeholder="Search by name, admission no, class...">
        </div>
        <div class="col-md-6 text-end">
            <a href="/admin/students/student/add/" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add New Student
            </a>
        </div>
    </div>
    
    <div id="studentError" class="alert alert-danger d-none"></div>
    
    <div class="table-responsive">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <button id="batchDeleteBtn" class="btn btn-danger btn-sm" disabled>
                    <i class="fas fa-trash"></i> Delete Selected
                </button>
            </div>
        </div>
        
        <table class="table table-hover align-middle" id="studentsTable">
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAllStudents"></th>
                    <th>#</th>
                    <th>Name</th>
                    <th>Roll Number</th>
                    <th>Class</th>
                    <th>Section</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="studentsTableBody">
                <!-- Populated by JavaScript -->
            </tbody>
        </table>
        
        <div id="studentLoading" class="text-center my-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableBody = document.getElementById('studentsTableBody');
    const loadingSpinner = document.getElementById('studentLoading');
    const errorDiv = document.getElementById('studentError');
    const searchInput = document.getElementById('studentSearch');
    
    // Sample data for demonstration
    const studentsData = [
        {
            id: 1,
            name: "Aarav Sharma",
            roll_number: "S1001",
            class_name: "10",
            section: "A",
            status: "Active"
        },
        {
            id: 2,
            name: "Priya Verma", 
            roll_number: "S1002",
            class_name: "10",
            section: "B",
            status: "Active"
        },
        {
            id: 3,
            name: "Rohan Gupta",
            roll_number: "S1003", 
            class_name: "9",
            section: "A",
            status: "Active"
        },
        {
            id: 4,
            name: "Simran Kaur",
            roll_number: "S1004",
            class_name: "8", 
            section: "C",
            status: "Active"
        },
        {
            id: 5,
            name: "Aditya Singh",
            roll_number: "S1005",
            class_name: "11",
            section: "A", 
            status: "Active"
        }
    ];
    
    let selectedStudents = new Set();
    
    function renderTable(data) {
        tableBody.innerHTML = '';
        
        if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No students found.</td></tr>';
            return;
        }
        
        data.forEach(function(student) {
            const checked = selectedStudents.has(student.id) ? 'checked' : '';
            const statusBadge = student.status === 'Active' 
                ? '<span class="badge bg-success">Active</span>'
                : '<span class="badge bg-secondary">Inactive</span>';
                
            const row = `
                <tr>
                    <td>
                        <input type="checkbox" class="student-checkbox" data-id="${student.id}" ${checked}>
                    </td>
                    <td>${student.id}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                                ${student.name.charAt(0)}
                            </div>
                            <div>
                                <div class="fw-semibold">${student.name}</div>
                                ${statusBadge}
                            </div>
                        </div>
                    </td>
                    <td>${student.roll_number}</td>
                    <td>${student.class_name}</td>
                    <td>${student.section}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="/admin/students/student/${student.id}/change/" class="btn btn-outline-primary">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <button class="btn btn-outline-danger" onclick="deleteStudent(${student.id}, '${student.name}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
        
        // Update checkbox listeners
        document.querySelectorAll('.student-checkbox').forEach(cb => {
            cb.addEventListener('change', function() {
                const id = parseInt(this.getAttribute('data-id'));
                if (this.checked) {
                    selectedStudents.add(id);
                } else {
                    selectedStudents.delete(id);
                }
                updateBatchDeleteBtn();
                updateSelectAllCheckbox();
            });
        });
        
        updateSelectAllCheckbox();
    }
    
    function filterStudents() {
        const query = searchInput.value.toLowerCase();
        const filtered = studentsData.filter(student => 
            student.name.toLowerCase().includes(query) ||
            student.roll_number.toLowerCase().includes(query) ||
            student.class_name.toLowerCase().includes(query) ||
            student.section.toLowerCase().includes(query)
        );
        renderTable(filtered);
    }
    
    function updateBatchDeleteBtn() {
        const batchDeleteBtn = document.getElementById('batchDeleteBtn');
        if (batchDeleteBtn) {
            batchDeleteBtn.disabled = selectedStudents.size === 0;
        }
    }
    
    function updateSelectAllCheckbox() {
        const selectAllCb = document.getElementById('selectAllStudents');
        if (selectAllCb) {
            selectAllCb.checked = studentsData.length > 0 && selectedStudents.size === studentsData.length;
        }
    }
    
    // Load students
    function loadStudents() {
        loadingSpinner.classList.remove('d-none');
        errorDiv.classList.add('d-none');
        
        // Simulate loading delay
        setTimeout(function() {
            loadingSpinner.classList.add('d-none');
            renderTable(studentsData);
        }, 800);
    }
    
    // Event listeners
    searchInput.addEventListener('input', filterStudents);
    
    const selectAllCb = document.getElementById('selectAllStudents');
    if (selectAllCb) {
        selectAllCb.addEventListener('change', function() {
            if (this.checked) {
                studentsData.forEach(s => selectedStudents.add(s.id));
            } else {
                selectedStudents.clear();
            }
            renderTable(studentsData);
            updateBatchDeleteBtn();
        });
    }
    
    // Initialize
    loadStudents();
});

// Global functions
function deleteStudent(id, name) {
    if (confirm(`Are you sure you want to delete ${name}?`)) {
        alert('Delete functionality would be implemented here');
    }
}
</script>

{% endblock %}
